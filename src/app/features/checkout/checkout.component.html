<div class="checkout-wrapper">
  <!-- Floating Coupon Notification Banner -->
  <div class="coupon-notification-floating" *ngIf="showCouponMessage" [@slideNotification]
    [class.success]="couponMessageType === 'success'" [class.error]="couponMessageType === 'error'">
    <span class="coupon-message-text">{{ couponMessage }}</span>
    <button type="button" class="close-notification" (click)="dismissCouponNotification()">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    </button>
  </div>

  <!-- Coupon Validation Overlay -->
  <div class="coupon-validation-overlay" *ngIf="isValidatingCoupon">
    <div class="validation-card">
      <div class="validation-spinner">
        <svg class="spinner-ring" viewBox="0 0 50 50">
          <circle class="path" cx="25" cy="25" r="20" fill="none" stroke-width="4"></circle>
        </svg>
      </div>
      <h3>Validating Coupon</h3>
      <p>Please wait while we check your discount code...</p>
    </div>
  </div>

  <!-- Processing Overlay -->
  <div class="processing-overlay" *ngIf="isProcessing">
    <div class="processing-card">
      <div class="processing-spinner">
        <svg class="spinner-ring" viewBox="0 0 50 50">
          <circle class="path" cx="25" cy="25" r="20" fill="none" stroke-width="4"></circle>
        </svg>
      </div>
      <h3>Processing Payment</h3>
      <p>Please wait while we securely process your payment...</p>
    </div>
  </div>

  <!-- Success Message Overlay -->
  <div class="success-overlay" *ngIf="successMessage">
    <div class="success-card">
      <div class="success-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
          <polyline points="22 4 12 14.01 9 11.01"></polyline>
        </svg>
      </div>
      <h2>{{ successMessage }}</h2>
    </div>
  </div>

  <!-- Compact Campaign Countdown (Site-wide campaigns only) -->
  <div class="campaign-countdown-compact" *ngIf="isSiteWideCampaign && appliedCoupon">
    <div class="countdown-content">
      <div class="countdown-info">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2" class="clock-icon">
          <circle cx="12" cy="12" r="10"></circle>
          <polyline points="12 6 12 12 16 14"></polyline>
        </svg>
        <span class="countdown-label">Offer ends in:</span>
      </div>
      <div class="countdown-timer-compact">
        <div class="time-unit-compact" *ngIf="campaignTimeRemaining.days > 0">
          <span class="time-value-compact">{{ formatTime(campaignTimeRemaining.days) }}</span>
          <span class="time-label-compact">d</span>
        </div>
        <span class="time-separator" *ngIf="campaignTimeRemaining.days > 0">:</span>
        <div class="time-unit-compact">
          <span class="time-value-compact">{{ formatTime(campaignTimeRemaining.hours) }}</span>
          <span class="time-label-compact">h</span>
        </div>
        <span class="time-separator">:</span>
        <div class="time-unit-compact">
          <span class="time-value-compact">{{ formatTime(campaignTimeRemaining.minutes) }}</span>
          <span class="time-label-compact">m</span>
        </div>
        <span class="time-separator">:</span>
        <div class="time-unit-compact">
          <span class="time-value-compact">{{ formatTime(campaignTimeRemaining.seconds) }}</span>
          <span class="time-label-compact">s</span>
        </div>
      </div>
    </div>
  </div>

  <div class="checkout-container">
    <!-- Left Side: Checkout Form -->
    <div class="checkout-form-section">
      <!-- Header -->
      <div class="checkout-header">
        <h1>Complete Your Purchase</h1>
        <p class="subtitle">Join thousands of successful traders</p>
      </div>

      <!-- Error Message -->
      <div class="error-alert" *ngIf="errorMessage">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="12" y1="8" x2="12" y2="12"></line>
          <line x1="12" y1="16" x2="12.01" y2="16"></line>
        </svg>
        <span>{{ errorMessage }}</span>
      </div>

      <!-- Single Flow Form -->
      <form class="checkout-form">
        <!-- Account Information Section -->
        <div class="form-section">
          <div class="section-header">
            <div class="section-number">1</div>
            <h2>Create Account</h2>
          </div>

          <div class="form-grid user-info">
            <!-- Full Name -->
            <div class="form-group full-width">
              <label for="fullName">Full Name</label>
              <input type="text" id="fullName" [(ngModel)]="fullName" name="fullName" placeholder="Enter your name"
                (blur)="validateName()" [class.error]="nameError" />
              <span class="error-message" *ngIf="nameError">{{ nameError }}</span>
            </div>

            <!-- Email -->
            <div class="form-group">
              <label for="email">Email Address</label>
              <input type="email" id="email" [(ngModel)]="email" name="email" placeholder="Enter your email"
                (blur)="validateEmail()" [class.error]="emailError" />
              <span class="error-message" *ngIf="emailError">{{ emailError }}</span>
            </div>

            <!-- Password -->
            <div class="form-group">
              <label for="password">Password (min. 8 char)</label>
              <div class="password-input-wrapper">
                <input [type]="showPassword ? 'text' : 'password'" id="password" [(ngModel)]="password" name="password"
                  placeholder="Enter a password" (blur)="validatePassword()" [class.error]="passwordError" />
                <button type="button" class="password-toggle" (click)="togglePasswordVisibility()" tabindex="-1">
                  <svg *ngIf="!showPassword" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                    <circle cx="12" cy="12" r="3"></circle>
                  </svg>
                  <svg *ngIf="showPassword" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path
                      d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24">
                    </path>
                    <line x1="1" y1="1" x2="23" y2="23"></line>
                  </svg>
                </button>
              </div>
              <span class="error-message" *ngIf="passwordError">{{ passwordError }}</span>
            </div>
          </div>
        </div>

        <!-- Payment Information Section -->
        <div class="form-section">
          <div class="section-header">
            <div class="section-number">2</div>
            <h2>Payment Information</h2>
          </div>

          <!-- Stripe Card Number -->
          <div class="form-group">
            <label>Card Number</label>
            <div class="card-element-wrapper">
              <div #cardNumber class="card-element"></div>
            </div>
          </div>

          <!-- Expiry and CVV -->
          <div class="form-grid">
            <div class="form-group">
              <label>Expiry Date</label>
              <div class="card-element-wrapper">
                <div #cardExpiry class="card-element"></div>
              </div>
            </div>
            <div class="form-group">
              <label>CVV</label>
              <div class="card-element-wrapper">
                <div #cardCvc class="card-element"></div>
              </div>
            </div>
          </div>

          <span class="error-message" *ngIf="cardError">{{ cardError }}</span>

          <div class="payment-methods">
            <!-- Visa -->
            <svg viewBox="0 0 48 32" class="card-icon">
              <rect width="48" height="32" rx="4" fill="#1434CB" />
              <text x="24" y="21" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white"
                text-anchor="middle">VISA</text>
            </svg>
            <!-- Mastercard -->
            <svg viewBox="0 0 48 32" class="card-icon">
              <rect width="48" height="32" rx="4" fill="#EB001B" />
              <circle cx="18" cy="16" r="9" fill="#FF5F00" opacity="0.8" />
              <circle cx="30" cy="16" r="9" fill="#F79E1B" opacity="0.8" />
            </svg>
            <!-- American Express -->
            <svg viewBox="0 0 48 32" class="card-icon">
              <rect width="48" height="32" rx="4" fill="#006FCF" />
              <text x="24" y="21" font-family="Arial, sans-serif" font-size="9" font-weight="bold" fill="white"
                text-anchor="middle">AMEX</text>
            </svg>
            <!-- Discover -->
            <svg viewBox="0 0 48 32" class="card-icon">
              <rect width="48" height="32" rx="4" fill="#FF6000" />
              <circle cx="40" cy="16" r="8" fill="#FFAA00" opacity="0.5" />
            </svg>
          </div>
        </div>

        <!-- Terms & Conditions -->
        <div class="checkbox-group">
          <input type="checkbox" id="terms" [(ngModel)]="agreeToTerms" name="terms" />
          <label for="terms">
            I agree to the <a href="/terms" target="_blank">Terms & Conditions</a> and
            <a href="/privacy" target="_blank">Privacy Policy</a>
          </label>
        </div>

        <!-- Payment Error (Card/Payment Issues) -->
        <div class="payment-error-alert" *ngIf="paymentError">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
            stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="12" y1="8" x2="12" y2="12"></line>
            <line x1="12" y1="16" x2="12.01" y2="16"></line>
          </svg>
          <span>{{ paymentError }}</span>
        </div>

        <!-- Submit Button -->
        <button type="button" class="btn-primary" (click)="processPayment()" [disabled]="isProcessing">
          <div class="button-content">
            <div class="button-main">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                <path fill-rule="evenodd"
                  d="M12 1.5a5.25 5.25 0 00-5.25 5.25v3a3 3 0 00-3 3v6.75a3 3 0 003 3h10.5a3 3 0 003-3v-6.75a3 3 0 00-3-3v-3c0-2.9-2.35-5.25-5.25-5.25zm3.75 8.25v-3a3.75 3.75 0 10-7.5 0v3h7.5z"
                  clip-rule="evenodd" />
              </svg>
              <span>Complete Purchase - ${{ finalPrice.toFixed(2) }}</span>
            </div>
            <span class="guarantee-text">30-day money-back guarantee</span>
          </div>
        </button>

        <!-- Security Notice -->
        <div class="security-notice">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
            stroke-width="2">
            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
          </svg>
          <span>Your payment information is secured by Stripe.</span>
        </div>

        <!-- Login Link -->
        <p class="login-link">
          Already have an account? <a routerLink="/login">Sign in here</a>
        </p>
      </form>
    </div>

    <!-- Right Side: Order Summary -->
    <div class="order-summary-section">
      <div class="order-card">
        <h3>Order Summary</h3>

        <!-- Simple Course Info with Thumbnail -->
        <div class="simple-course-info">
          <img [src]="courseThumbnail" [alt]="courseName" class="course-thumb" />
          <div class="course-details">
            <h4>{{ courseName }}</h4>
            <p>{{ courseDescription }}</p>
          </div>
        </div>

        <div class="divider"></div>

        <!-- Price Breakdown -->
        <div class="price-section">
          <div class="price-row">
            <span>Course Price</span>
            <span class="amount" [class.strikethrough]="appliedCoupon">${{ coursePrice.toFixed(2) }}</span>
          </div>

          <!-- Discount Row (only show if coupon applied) -->
          <div class="price-row discount" *ngIf="appliedCoupon">
            <span class="discount-label">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                stroke-width="2" class="discount-icon">
                <circle cx="9" cy="9" r="1"></circle>
                <circle cx="15" cy="15" r="1"></circle>
                <path d="M16 8l-8 8"></path>
                <path d="M20 4l-8.5 8.5"></path>
                <path d="M12 12l-8.5 8.5"></path>
                <path d="M4 4l16 16"></path>
              </svg>
              Discount ({{ appliedCoupon.code }})
            </span>
            <span class="discount-amount">-${{ discountAmount.toFixed(2) }}</span>
          </div>

          <div class="price-row total">
            <span>Total</span>
            <span class="total-amount" [class.discounted]="appliedCoupon">${{ finalPrice.toFixed(2) }}</span>
          </div>

          <!-- Savings Badge -->
          <div class="savings-badge" *ngIf="appliedCoupon">
            ðŸŽ‰ You save ${{ discountAmount.toFixed(2) }}!
          </div>
        </div>

        <!-- Trust Badges -->
        <div class="trust-badges">
          <div class="badge">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
              stroke-width="2">
              <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
            </svg>
            <span>SSL Secure</span>
          </div>
          <div class="badge">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
              stroke-width="2">
              <path
                d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z">
              </path>
              <polyline points="7.5 4.21 12 6.81 16.5 4.21"></polyline>
              <polyline points="7.5 19.79 7.5 14.6 3 12"></polyline>
              <polyline points="21 12 16.5 14.6 16.5 19.79"></polyline>
              <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
              <line x1="12" y1="22.08" x2="12" y2="12"></line>
            </svg>
            <span>Verified by Stripe</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>