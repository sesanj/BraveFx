<!-- Premium Reviews Section -->
<section class="reviews-section">
  <div class="container">
    <!-- Section Header with Stats -->
    <div class="section-header-center">
      <div class="badge">
        <lucide-icon [img]="MessageCircle" class="badge-icon"></lucide-icon>
        <span>Student Success Stories</span>
      </div>
      <h2 class="section-title">
        Loved by <span class="gradient-text">{{reviewsData?.stats?.reviewsWithComments || 458}} Traders</span> Worldwide
      </h2>
      <p class="section-description" *ngIf="reviewsData">
        {{ reviewsData.stats.totalReviews | number }} total reviews •
        {{ reviewsData.stats.averageRating + .1}} <span class="star-inline">★</span> average rating
      </p>
    </div>

    <!-- Regional Breakdown Stats -->
    <div class="regional-stats" *ngIf="reviewsData?.regionalBreakdown">
      <div class="stat-pill" *ngFor="let region of getTopRegions()">
        <lucide-icon [img]="Globe" class="region-icon"></lucide-icon>
        <span class="region-name">{{ region.name }}</span>
        <span class="region-percentage">{{ region.percentage }}%</span>
      </div>
    </div>

    <!-- Featured Reviews Carousel -->
    <div class="featured-reviews-carousel" *ngIf="featuredReviews.length > 0">
      <!-- Carousel Wrapper -->
      <div class="carousel-wrapper">
        <div class="carousel-track" [style.grid-template-columns]="carouselTrackColumns"
          [style.transform]="'translateX(-' + (currentCarouselIndex * 100) + '%)'">
          <!-- Dynamic Slides -->
          <div *ngFor="let slideIndex of [].constructor(totalCarouselSlides); let i = index"
            [style.grid-template-columns]="slideGridColumns">
            <div class="review-card premium-card" *ngFor="let review of getCarouselSlide(i)">
              <div class="review-header">
                <div class="rating-stars">
                  <span class="star-filled" *ngFor="let star of getStarArray(review.rating)">★</span>
                </div>
                <div class="verified-badge-premium">
                  <lucide-icon [img]="CheckCircle2" class="verified-icon"></lucide-icon>
                  <span>Verified Purchase</span>
                </div>
              </div>
              <div>
                <p class="review-comment truncated">"{{ review.comment }}"</p>
                <button class="read-more-btn" (click)="openSingleReviewModal(review)">
                  <span>Read full review</span>
                  <lucide-icon [img]="ArrowRight"></lucide-icon>
                </button>
              </div>
              <div class="review-footer">
                <div class="reviewer-info">
                  <div class="reviewer-name">{{ review.name }}</div>
                  <div class="reviewer-meta">
                    <lucide-icon [img]="MapPin" class="meta-icon"></lucide-icon>
                    <span>{{ review.location }}</span>
                    <span class="separator">•</span>
                    <span>{{ review.date | date: 'MMM yyyy' }}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Carousel Controls -->
      <div class="carousel-controls">
        <button class="carousel-nav-btn" [class.disabled]="!canGoPrevious" [disabled]="!canGoPrevious"
          (click)="previousSlide()">
          <lucide-icon [img]="ChevronLeft"></lucide-icon>
        </button>
        <div class="carousel-indicators">
          <span class="indicator" *ngFor="let slide of [].constructor(totalCarouselSlides); let i = index"
            [class.active]="currentCarouselIndex === i" (click)="goToSlide(i)">
          </span>
        </div>
        <button class="carousel-nav-btn" [class.disabled]="!canGoNext" [disabled]="!canGoNext" (click)="nextSlide()">
          <lucide-icon [img]="ChevronRight"></lucide-icon>
        </button>
      </div>
    </div>

    <!-- View All Reviews Button -->
    <div class="view-all-container">
      <button class="btn-view-all" (click)="openReviewsModal()">
        <span>View All {{ reviewsData?.stats?.reviewsWithComments || 458 }} Reviews</span>
        <lucide-icon [img]="ArrowRight" class="btn-icon"></lucide-icon>
      </button>
    </div>
  </div>
</section>

<!-- Reviews Modal -->
<div class="modal-overlay" *ngIf="isReviewsModalOpen" (click)="closeReviewsModal()">
  <div class="modal-content reviews-modal" (click)="$event.stopPropagation()">
    <!-- Modal Header -->
    <div class="modal-header">
      <div class="modal-title-section">
        <h2>All Student Reviews</h2>
        <p class="modal-subtitle">
          {{ filteredReviews.length | number }} reviews •
          {{ reviewsData?.stats?.averageRating }} <span class="star-inline">★</span> average
        </p>
      </div>
      <button class="close-btn" (click)="closeReviewsModal()">
        <lucide-icon [img]="X" class="close-icon"></lucide-icon>
      </button>
    </div>

    <!-- Filters Section -->
    <div class="filters-section">
      <div class="filter-group">
        <label class="filter-label">
          <lucide-icon [img]="Filter" class="filter-icon"></lucide-icon>
          <span>Filters</span>
        </label>
        <div class="filter-controls">
          <!-- Rating Filter -->
          <select class="filter-select" [value]="selectedRatingFilter"
            (change)="onRatingFilterChange($any($event.target).value)">
            <option value="all">All Ratings</option>
            <option value="5">5 Stars</option>
            <option value="4">4 Stars</option>
            <option value="3">3 Stars</option>
            <option value="2">2 Stars</option>
            <option value="1">1 Star</option>
          </select>

          <!-- Region Filter -->
          <select class="filter-select" [value]="selectedRegionFilter"
            (change)="onRegionFilterChange($any($event.target).value)">
            <option value="all">All Regions</option>
            <option *ngFor="let region of uniqueRegions" [value]="region">{{ region }}</option>
          </select>

          <!-- Sort Filter -->
          <select class="filter-select" [value]="selectedSortFilter"
            (change)="onSortFilterChange($any($event.target).value)">
            <option value="recent">Most Recent</option>
            <option value="highest">Highest Rated</option>
            <option value="lowest">Lowest Rated</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Reviews Grid -->
    <div class="modal-reviews-grid">
      <div class="modal-review-card" *ngFor="let review of paginatedReviews">
        <div class="review-card-header">
          <div class="rating-stars">
            <span class="star-filled" *ngFor="let star of getStarArray(review.rating)">★</span>
          </div>
          <div class="verified-badge-small">
            <lucide-icon [img]="CheckCircle2" class="verified-icon-small"></lucide-icon>
            <span>Verified Purchase</span>
          </div>
        </div>
        <p class="modal-review-comment">"{{ review.comment }}"</p>
        <div class="modal-review-footer">
          <div class="reviewer-details">
            <span class="reviewer-name-modal">{{ review.name }}</span>
            <div class="reviewer-location-modal">
              <lucide-icon [img]="MapPin" class="location-icon-small"></lucide-icon>
              <span>{{ review.location }}, {{ review.region }}</span>
            </div>
          </div>
          <div class="review-date-modal">{{ review.date | date: 'MMM d, yyyy' }}</div>
        </div>
      </div>
    </div>

    <!-- Pagination -->
    <div class="pagination-controls" *ngIf="totalReviewPages > 1">
      <button class="pagination-btn" [disabled]="currentReviewsPage === 1" (click)="previousReviewsPage()">
        <lucide-icon [img]="ChevronLeft" class="pagination-icon"></lucide-icon>
        Previous
      </button>
      <span class="pagination-info">
        Page {{ currentReviewsPage }} of {{ totalReviewPages }}
      </span>
      <button class="pagination-btn" [disabled]="currentReviewsPage === totalReviewPages" (click)="nextReviewsPage()">
        Next
        <lucide-icon [img]="ChevronRight" class="pagination-icon"></lucide-icon>
      </button>
    </div>
  </div>
</div>
<!-- Single Review Modal -->
<div class="modal-overlay single-review-overlay" *ngIf="isSingleReviewModalOpen" (click)="closeSingleReviewModal()">
  <div class="modal-content single-review-modal" (click)="$event.stopPropagation()">
    <button class="close-btn-single" (click)="closeSingleReviewModal()">
      <lucide-icon [img]="X" class="close-icon"></lucide-icon>
    </button>

    <div class="single-review-content">
      <div class="single-review-header">
        <div class="rating-stars-large">
          <span class="star-filled" *ngFor="let star of getStarArray(selectedReview?.rating || 5)">★</span>
        </div>
        <div class="verified-badge-large">
          <lucide-icon [img]="CheckCircle2" class="verified-icon-large"></lucide-icon>
          <span>Verified Purchase</span>
        </div>
      </div>

      <p class="single-review-text">"{{ selectedReview?.comment }}"</p>

      <div class="single-review-footer">
        <div class="reviewer-details-large">
          <div class="reviewer-name-large">{{ selectedReview?.name }}</div>
          <div class="reviewer-location-large">
            <lucide-icon [img]="MapPin" class="location-icon-large"></lucide-icon>
            <span>{{ selectedReview?.location }}, {{ selectedReview?.region }}</span>
            <span class="separator">•</span>
            <span>{{ selectedReview?.date | date: 'MMM yyyy' }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>